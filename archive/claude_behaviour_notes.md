# Claude 命令行工具行为观察

## 启动和界面

1. Claude 命令行工具启动后显示欢迎信息，包括当前工作目录
2. 提供命令提示：`/help` 获取帮助，`!` 进入bash模式，`/` 使用命令
3. 界面使用了ANSI转义序列控制终端显示（如光标移动、清屏）
4. 界面有文本输入区域，类似于现代化的命令行工具
5. 版本信息: "Claude Code v0.2.14"，目前是测试预览版

## 交互模式

1. 默认启动为交互模式，等待用户输入提示或命令
2. 用户可以输入文本内容，并使用`回车键`提交
3. 支持输入长文本，可使用`\⏎`输入换行符
4. 支持特殊键如`Esc`键（撤销）
5. 提供输入建议，如示例提示 "Try 'how do I log an error?'"

## 命令和功能

1. `/` 开头的是命令模式 (如 `/help`, `/exit`, `/clear` 等)
2. `!` 是进入Bash执行模式
3. 显示处理状态，如 "Hustling... (0s · esc to interrupt)"
4. 可以访问当前目录的文件，并能经过用户许可运行命令和编辑文件
5. `/help` 显示帮助信息和版本信息

## 交互式特点

1. 利用ANSI转义序列进行屏幕控制和格式化
2. 使用[2K（清除当前行）和[1A（光标上移）等控制序列进行界面更新
3. 使用Unicode字符进行界面美化（如 ✻ 字符和方框）
4. 使用动态显示状态（如 "Hustling..."）来指示处理中
5. 提供中断机制（ESC键）来中断长时间运行的任务

## 运行模式

1. **交互模式**：默认模式，持续对话
2. **单次模式**：使用 `-p/--print` 选项，单次响应后退出
3. **命令模式**：以 `/` 开头的命令

## 设计考虑

基于观察，使用pexpect与Claude交互时需要：

1. 处理ANSI转义序列和控制字符
2. 正确识别Claude的提示模式
3. 支持特殊键输入（回车、ESC等）
4. 识别何时Claude在等待输入
5. 区分正常输出和命令提示
6. 识别处理状态指示器（如 "Hustling..."）
7. 处理动态更新的界面

## pexpect实现考虑

1. 需要使用`child.interact()`进入完全交互模式，或仔细管理交互过程
2. 需要设置合适的终端大小（`setwinsize`）
3. 启用ANSI转义序列处理
4. 检测特定模式如输入提示符、处理状态等
5. 可能需要特殊处理ESC键等控制字符

## 待验证行为

1. Claude如何表示等待用户输入（可能是显示输入提示框）
2. Claude如何处理长时间运行的任务（已观察到有状态指示）
3. 如何区分Claude的输出完成和等待输入状态（可能需要识别输入框模式）
4. Claude对工具使用的处理机制（如运行Bash命令时的交互）
5. 命令执行完成后的状态指示机制